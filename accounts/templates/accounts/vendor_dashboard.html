{% extends "accounts/vendor_base.html" %}

{% block title %}Vendor Dashboard - Namaste Nomad{% endblock %}

{% block content %}
<section class="hero">
    <div>
        <h1>Vendor Dashboard</h1>
        <p>Manage your packages and track your performance.</p>
    </div>
    <a class="primary-action" href="{% url 'vendor_packages' %}">
        <span>+</span>
        Create New Package
    </a>
</section>

<section class="stats-grid">
    <div class="stat-card">
        <div class="stat-title">Total Revenue</div>
        <div class="stat-value">Rs {{ stats.total_revenue|floatformat:0 }}</div>
        <span class="stat-chip green">All time</span>
    </div>
    <div class="stat-card">
        <div class="stat-title">Active Packages</div>
        <div class="stat-value">{{ stats.active_packages }}</div>
        <span class="stat-chip blue">Active</span>
    </div>
    <div class="stat-card">
        <div class="stat-title">Total Bookings</div>
        <div class="stat-value">{{ stats.total_bookings }}</div>
        <span class="stat-chip purple">All time</span>
    </div>
    <div class="stat-card">
        <div class="stat-title">Pending Bookings</div>
        <div class="stat-value">{{ stats.pending_bookings }}</div>
        <span class="stat-chip amber">Action</span>
    </div>
    <div class="stat-card">
        <div class="stat-title">Average Rating</div>
        <div class="stat-value">{{ stats.average_rating|floatformat:1 }}</div>
        <span class="stat-chip green">Score</span>
    </div>
</section>

<section class="cards-grid">
    <div class="card chart-card">
        <div class="card-header">
            <h3>Revenue This Month</h3>
            <span class="card-meta">Last 4 weeks</span>
        </div>
        <div class="bar-chart">
            {% for week in weekly_revenue %}
                <div class="bar" style="--bar: {{ week.percent }}%;">
                    <span>{{ week.label }}</span>
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="card chart-card">
        <div class="card-header">
            <h3>Bookings Over Time</h3>
            <span class="card-meta">Last 7 days</span>
        </div>
        <div class="line-chart">
            <svg viewBox="0 0 320 160" preserveAspectRatio="none" aria-hidden="true">
                <polyline points="{{ line_points }}"
                          fill="none" stroke="url(#lineGradient)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                <defs>
                    <linearGradient id="lineGradient" x1="0" x2="1" y1="0" y2="1">
                        <stop offset="0%" stop-color="#2563eb"/>
                        <stop offset="100%" stop-color="#60a5fa"/>
                    </linearGradient>
                </defs>
            </svg>
            <div class="chart-labels">
                {% for day in daily_counts %}
                    <span>{{ day.label }}</span>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="card chart-card">
        <div class="card-header">
            <h3>Booking Sources</h3>
            <span class="card-meta">Top channels</span>
        </div>
        <div class="pie-wrapper">
            <div class="pie-chart" style="background: {{ pie_gradient }};"></div>
            <div class="pie-legend">
                {% for source in source_breakdown %}
                    <div class="legend-item">
                        <span class="dot" style="background: {{ source.color }};"></span>
                        {{ source.label }} ({{ source.percent }}%)
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<section class="cards-grid split">
    <div class="card list-card">
        <div class="card-header">
            <h3>Upcoming Bookings</h3>
            <span class="card-meta">Next 14 days</span>
        </div>
        <div class="booking-list">
            {% if upcoming_bookings %}
                {% for booking in upcoming_bookings %}
                    <div class="booking-item">
                        <div class="booking-avatar">
                            {{ booking.traveler.first_name|default:"T"|slice:":1" }}{{ booking.traveler.last_name|default:""|slice:":1" }}
                        </div>
                        <div class="booking-info">
                            <div class="booking-name">
                                {{ booking.traveler.get_full_name|default:"Traveler" }}
                            </div>
                            <div class="booking-meta">
                                {{ booking.package.title }} - {{ booking.start_date|date:"M d" }} - {{ booking.end_date|date:"M d" }}
                            </div>
                        </div>
                        <div class="booking-actions">
                            <span class="status {{ booking.status }}">{{ booking.status|title }}</span>
                            <button class="btn small success">Confirm</button>
                            <button class="btn small danger">Cancel</button>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">No upcoming bookings yet.</div>
            {% endif %}
        </div>
    </div>

    <div class="card list-card">
        <div class="card-header">
            <h3>Package Performance</h3>
            <span class="card-meta">Top packages</span>
        </div>
        <div class="package-list">
            {% if package_performance %}
                {% for package in package_performance %}
                    <div class="package-item">
                        <div>
                            <div class="package-name">{{ package.title }}</div>
                            <div class="package-meta">
                                Views {{ package.views_count }} - Bookings {{ package.booking_count }} - Rating {{ package.avg_rating|default:0|floatformat:1 }}
                            </div>
                        </div>
                        <div class="package-revenue">Rs {{ package.price|floatformat:0 }}</div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">No packages added yet.</div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}
